{"version":3,"sources":["../../../../src/tile-layer/utils/tile.js"],"names":["Tile","getTileData","x","y","z","onGetTileDataError","isVisible","_data","_isLoaded","_loader","_loadData","getTileDataPromise","then","buffers","catch","err","tile","m","Math","pow","floor","Promise","resolve"],"mappings":";;;;;;;;;;;;;IAAqBA,I;;;AACnB,sBAAwD;AAAA,QAA3CC,WAA2C,QAA3CA,WAA2C;AAAA,QAA9BC,CAA8B,QAA9BA,CAA8B;AAAA,QAA3BC,CAA2B,QAA3BA,CAA2B;AAAA,QAAxBC,CAAwB,QAAxBA,CAAwB;AAAA,QAArBC,kBAAqB,QAArBA,kBAAqB;;AAAA;;AACtD,SAAKH,CAAL,GAASA,CAAT;AACA,SAAKC,CAAL,GAASA,CAAT;AACA,SAAKC,CAAL,GAASA,CAAT;AACA,SAAKE,SAAL,GAAiB,IAAjB;AACA,SAAKL,WAAL,GAAmBA,WAAnB;AACA,SAAKM,KAAL,GAAa,IAAb;AACA,SAAKC,SAAL,GAAiB,KAAjB;AACA,SAAKC,OAAL,GAAe,KAAKC,SAAL,EAAf;AACA,SAAKL,kBAAL,GAA0BA,kBAA1B;AACD;;;;gCAaW;AAAA;;AAAA,UACHH,CADG,GACQ,IADR,CACHA,CADG;AAAA,UACAC,CADA,GACQ,IADR,CACAA,CADA;AAAA,UACGC,CADH,GACQ,IADR,CACGA,CADH;;AAEV,UAAI,CAAC,KAAKH,WAAV,EAAuB;AACrB,eAAO,IAAP;AACD;;AACD,UAAMU,kBAAkB,GAAG,KAAKV,WAAL,CAAiB;AAACC,QAAAA,CAAC,EAADA,CAAD;AAAIC,QAAAA,CAAC,EAADA,CAAJ;AAAOC,QAAAA,CAAC,EAADA;AAAP,OAAjB,CAA3B;AACA,aAAOO,kBAAkB,CACtBC,IADI,CACC,UAAAC,OAAO,EAAI;AACf,QAAA,KAAI,CAACN,KAAL,GAAaM,OAAb;AACA,QAAA,KAAI,CAACL,SAAL,GAAiB,IAAjB;AACA,eAAOK,OAAP;AACD,OALI,EAMJC,KANI,CAME,UAAAC,GAAG,EAAI;AACZ,QAAA,KAAI,CAACP,SAAL,GAAiB,IAAjB;;AACA,QAAA,KAAI,CAACH,kBAAL,CAAwBU,GAAxB;AACD,OATI,CAAP;AAUD;;;iCAEYC,I,EAAM;AAAA,UACVd,CADU,GACC,IADD,CACVA,CADU;AAAA,UACPC,CADO,GACC,IADD,CACPA,CADO;AAAA,UACJC,CADI,GACC,IADD,CACJA,CADI;AAEjB,UAAMa,CAAC,GAAGC,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYH,IAAI,CAACZ,CAAL,GAASA,CAArB,CAAV;AACA,aAAOc,IAAI,CAACE,KAAL,CAAWJ,IAAI,CAACd,CAAL,GAASe,CAApB,MAA2Bf,CAA3B,IAAgCgB,IAAI,CAACE,KAAL,CAAWJ,IAAI,CAACb,CAAL,GAASc,CAApB,MAA2Bd,CAAlE;AACD;;;wBAjCU;AACT,UAAI,KAAKI,KAAT,EAAgB;AACd,eAAOc,OAAO,CAACC,OAAR,CAAgB,KAAKf,KAArB,CAAP;AACD;;AACD,aAAO,KAAKE,OAAZ;AACD;;;wBAEc;AACb,aAAO,KAAKD,SAAZ;AACD","sourcesContent":["export default class Tile {\n  constructor({getTileData, x, y, z, onGetTileDataError}) {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    this.isVisible = true;\n    this.getTileData = getTileData;\n    this._data = null;\n    this._isLoaded = false;\n    this._loader = this._loadData();\n    this.onGetTileDataError = onGetTileDataError;\n  }\n\n  get data() {\n    if (this._data) {\n      return Promise.resolve(this._data);\n    }\n    return this._loader;\n  }\n\n  get isLoaded() {\n    return this._isLoaded;\n  }\n\n  _loadData() {\n    const {x, y, z} = this;\n    if (!this.getTileData) {\n      return null;\n    }\n    const getTileDataPromise = this.getTileData({x, y, z});\n    return getTileDataPromise\n      .then(buffers => {\n        this._data = buffers;\n        this._isLoaded = true;\n        return buffers;\n      })\n      .catch(err => {\n        this._isLoaded = true;\n        this.onGetTileDataError(err);\n      });\n  }\n\n  isOverlapped(tile) {\n    const {x, y, z} = this;\n    const m = Math.pow(2, tile.z - z);\n    return Math.floor(tile.x / m) === x && Math.floor(tile.y / m) === y;\n  }\n}\n"],"file":"tile.js"}