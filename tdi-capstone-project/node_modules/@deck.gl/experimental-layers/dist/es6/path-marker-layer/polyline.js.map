{"version":3,"sources":["../../../src/path-marker-layer/polyline.js"],"names":["Vector3","clamp","getClosestPointOnLine","p","p1","p2","clampToLine","lineVector","subtract","pointVector","dotProduct","dot","lerp","getClosestPointOnPolyline","points","pClosest","distanceSquared","Infinity","index","i","length","pClosestOnLine","distanceToLineSquared","point","distance","Math","sqrt"],"mappings":"AAAA,SAAQA,OAAR,EAAiBC,KAAjB,QAA6B,SAA7B,C,CAEA;;AACA,OAAO,SAASC,qBAAT,OAAgE;AAAA,MAAhCC,CAAgC,QAAhCA,CAAgC;AAAA,MAA7BC,EAA6B,QAA7BA,EAA6B;AAAA,MAAzBC,EAAyB,QAAzBA,EAAyB;AAAA,8BAArBC,WAAqB;AAAA,MAArBA,WAAqB,iCAAP,IAAO;AACrE,QAAMC,UAAU,GAAG,IAAIP,OAAJ,CAAYK,EAAZ,EAAgBG,QAAhB,CAAyBJ,EAAzB,CAAnB;AACA,QAAMK,WAAW,GAAG,IAAIT,OAAJ,CAAYG,CAAZ,EAAeK,QAAf,CAAwBJ,EAAxB,CAApB;AACA,MAAIM,UAAU,GAAGH,UAAU,CAACI,GAAX,CAAeF,WAAf,CAAjB;;AACA,MAAIH,WAAJ,EAAiB;AACfI,IAAAA,UAAU,GAAGT,KAAK,CAACS,UAAD,EAAa,CAAb,EAAgB,CAAhB,CAAlB;AACD;;AACD,SAAOH,UAAU,CAACK,IAAX,CAAgBF,UAAhB,CAAP;AACD,C,CAED;;AACA,OAAO,SAASG,yBAAT,QAAgD;AAAA,MAAZV,CAAY,SAAZA,CAAY;AAAA,MAATW,MAAS,SAATA,MAAS;AACrDX,EAAAA,CAAC,GAAG,IAAIH,OAAJ,CAAYG,CAAZ,CAAJ;AACA,MAAIY,QAAQ,GAAG,IAAf;AACA,MAAIC,eAAe,GAAGC,QAAtB;AACA,MAAIC,KAAK,GAAG,CAAC,CAAb;;AACA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,MAAM,CAACM,MAAP,GAAgB,CAApC,EAAuC,EAAED,CAAzC,EAA4C;AAC1C,UAAMf,EAAE,GAAGU,MAAM,CAACK,CAAD,CAAjB;AACA,UAAMd,EAAE,GAAGS,MAAM,CAACK,CAAC,GAAG,CAAL,CAAjB;AACA,UAAME,cAAc,GAAGnB,qBAAqB,CAAC;AAACC,MAAAA,CAAD;AAAIC,MAAAA,EAAJ;AAAQC,MAAAA;AAAR,KAAD,CAA5C;AACA,UAAMiB,qBAAqB,GAAGnB,CAAC,CAACa,eAAF,CAAkBK,cAAlB,CAA9B;;AACA,QAAIC,qBAAqB,GAAGN,eAA5B,EAA6C;AAC3CA,MAAAA,eAAe,GAAGM,qBAAlB;AACAP,MAAAA,QAAQ,GAAGM,cAAX;AACAH,MAAAA,KAAK,GAAGC,CAAR;AACD;AACF;;AACD,SAAO;AACLI,IAAAA,KAAK,EAAER,QADF;AAELG,IAAAA,KAFK;AAGLd,IAAAA,EAAE,EAAEU,MAAM,CAACI,KAAD,CAHL;AAILb,IAAAA,EAAE,EAAES,MAAM,CAACI,KAAK,GAAG,CAAT,CAJL;AAKLF,IAAAA,eALK;AAMLQ,IAAAA,QAAQ,EAAEC,IAAI,CAACC,IAAL,CAAUV,eAAV;AANL,GAAP;AAQD","sourcesContent":["import {Vector3, clamp} from 'math.gl';\n\n// Return the closest point on a line segment\nexport function getClosestPointOnLine({p, p1, p2, clampToLine = true}) {\n  const lineVector = new Vector3(p2).subtract(p1);\n  const pointVector = new Vector3(p).subtract(p1);\n  let dotProduct = lineVector.dot(pointVector);\n  if (clampToLine) {\n    dotProduct = clamp(dotProduct, 0, 1);\n  }\n  return lineVector.lerp(dotProduct);\n}\n\n// Return the closest point on a line segment\nexport function getClosestPointOnPolyline({p, points}) {\n  p = new Vector3(p);\n  let pClosest = null;\n  let distanceSquared = Infinity;\n  let index = -1;\n  for (let i = 0; i < points.length - 1; ++i) {\n    const p1 = points[i];\n    const p2 = points[i + 1];\n    const pClosestOnLine = getClosestPointOnLine({p, p1, p2});\n    const distanceToLineSquared = p.distanceSquared(pClosestOnLine);\n    if (distanceToLineSquared < distanceSquared) {\n      distanceSquared = distanceToLineSquared;\n      pClosest = pClosestOnLine;\n      index = i;\n    }\n  }\n  return {\n    point: pClosest,\n    index,\n    p1: points[index],\n    p2: points[index + 1],\n    distanceSquared,\n    distance: Math.sqrt(distanceSquared)\n  };\n}\n"],"file":"polyline.js"}